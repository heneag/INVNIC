<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sistema de Gestión de Inventario</title>
<base target="_top">
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
:root {
    --primary: #2c6fbb;
    --primary-dark: #1a56a0;
    --secondary: #28a745;
    --secondary-dark: #218838;
    --warning: #ffc107;
    --warning-dark: #e0a800;
    --danger: #dc3545;
    --danger-dark: #c82333;
    --light: #f8f9fa;
    --dark: #343a40;
    --gray: #6c757d;
    --light-gray: #e9ecef;
    --border-radius: 8px;
    --box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    --transition: all 0.3s ease;
}
* { box-sizing: border-box; margin: 0; padding: 0; }
body { font-family: 'Roboto', sans-serif; background: linear-gradient(135deg,#f5f7fa 0%,#e4e8f0 100%); color:#333; line-height:1.6; min-height:100vh; padding:0; width:100%; overflow-x:hidden; }
.container { max-width: 100%; margin:0 auto; padding:15px; }
header { background: var(--primary); color:white; padding:20px; border-radius: var(--border-radius); box-shadow: var(--box-shadow); margin-bottom:20px; position: relative; }
h1,h2,h3,h4 { margin-bottom:15px; font-weight:600; }
.card { background:white; border-radius: var(--border-radius); padding:20px; margin-bottom:20px; box-shadow: var(--box-shadow); transition: var(--transition); }
.card:hover { box-shadow:0 6px 16px rgba(0,0,0,0.15); }
.search-section { display:grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap:12px; margin-bottom:20px; }
.form-group { margin-bottom:15px; }
label { display:block; margin-bottom:8px; font-weight:500; color: var(--dark); }
input, select, button { width:100%; padding:12px 15px; border:1px solid var(--light-gray); border-radius: var(--border-radius); font-family:'Roboto',sans-serif; font-size:16px; transition: var(--transition); }
input:focus, select:focus { outline:none; border-color: var(--primary); box-shadow:0 0 0 3px rgba(44,111,187,0.2); }
button { background: var(--primary); color:white; border:none; cursor:pointer; font-weight:500; display:flex; align-items:center; justify-content:center; gap:8px; }
button:hover { background: var(--primary-dark); transform: translateY(-2px); }
button.secondary { background: var(--secondary); }
button.secondary:hover { background: var(--secondary-dark); }
button.outline { background: transparent; color: var(--primary); border:1px solid var(--primary); }
button.outline:hover { background: var(--primary); color:white; }
.results-container { display:grid; grid-template-columns:1fr 2fr; gap:20px; }
@media(max-width:968px){.results-container{grid-template-columns:1fr}.search-section{grid-template-columns:1fr}}
.product-list { max-height:500px; overflow-y:auto; }
.product-card { padding:15px; margin-bottom:10px; border-left:4px solid var(--primary); background:white; border-radius: var(--border-radius); cursor:pointer; transition: var(--transition); }
.product-card:hover { transform: translateX(5px); }
.product-card.selected { border-left-color: var(--secondary); background-color:#f0fff4; }
.product-detail { padding:20px; }
.notification { position: fixed; top:20px; right:20px; padding:15px 20px; background: var(--secondary); color:white; border-radius: var(--border-radius); box-shadow: var(--box-shadow); display:none; z-index:1000; animation: slideIn 0.3s ease; max-width:350px; }
@keyframes slideIn { from { transform:translateX(100px); opacity:0; } to { transform:translateX(0); opacity:1; } }
.log-section { margin-top:30px; }
.table-container { overflow-x:auto; margin-top:15px; }
table { width:100%; border-collapse:collapse; min-width:600px; }
th,td { padding:12px 15px; text-align:left; border-bottom:1px solid var(--light-gray); }
th { background-color: var(--primary); color:white; position:sticky; top:0; }
tr:nth-child(even){background-color:#f8f9fa;}
tr:hover{background-color:var(--light-gray);}
.empty-state{text-align:center;padding:40px 20px;color:var(--gray);}
.empty-state i{font-size:48px;margin-bottom:15px;color:var(--light-gray);}
.action-buttons{display:flex;gap:10px;margin-top:20px;}
.action-buttons button{width:auto;flex:1;}
.badge{display:inline-block;padding:4px 8px;border-radius:20px;font-size:12px;font-weight:500;margin-left:8px;}
.badge-primary{background: var(--primary); color:white;}
.badge-secondary{background: var(--secondary); color:white;}
.section-title{display:flex;align-items:center;gap:10px;margin-bottom:20px;padding-bottom:10px;border-bottom:2px solid var(--light-gray);}
.section-title i{color: var(--primary);}
.close-btn{position:absolute;top:15px;right:15px;background:transparent;color:white;border:none;font-size:24px;width:auto;padding:5px;cursor:pointer;}
.close-btn:hover{background:transparent;color:#ffdddd;transform:none;}
.estado-buttons{display:grid;grid-template-columns:repeat(2,1fr);gap:10px;margin:20px 0;}
.estado-btn{padding:20px 15px;border:none;border-radius:var(--border-radius);font-size:18px;font-weight:600;cursor:pointer;transition:var(--transition);display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;min-height:90px;}
.estado-btn i{font-size:24px;margin-bottom:8px;}
.estado-btn.selected{transform:scale(1.02);box-shadow:0 5px 15px rgba(0,0,0,0.2);}
.estado-btn.sin{background-color:#6c757d;color:white;}
.estado-btn.sin:hover,.estado-btn.sin.selected{background-color:#5a6268;}
.estado-btn.disponible{background-color:var(--secondary);color:white;}
.estado-btn.disponible:hover,.estado-btn.disponible.selected{background-color:var(--secondary-dark);}
.estado-btn.danado{background-color:var(--warning);color:#212529;}
.estado-btn.danado:hover,.estado-btn.danado.selected{background-color:var(--warning-dark);}
.estado-btn.defecto{background-color:var(--danger);color:white;}
.estado-btn.defecto:hover,.estado-btn.defecto.selected{background-color:var(--danger-dark);}
.cantidad-input{font-size:24px;padding:15px;text-align:center;font-weight:bold;}
.cantidad-controls{display:flex;align-items:center;margin:15px 0;}
.cantidad-btn{width:50px;height:50px;font-size:24px;font-weight:bold;border:none;border-radius:50%;background:var(--primary);color:white;cursor:pointer;display:flex;align-items:center;justify-content:center;}
.cantidad-value{margin:0 15px;font-size:24px;font-weight:bold;min-width:60px;text-align:center;}
.search-general{position:relative;margin-bottom:20px;}
.search-general input{padding-left:45px;font-size:18px;border-radius:30px;}
.search-general i{position:absolute;left:15px;top:50%;transform:translateY(-50%);color:var(--gray);font-size:20px;}
.search-suggestions{position:absolute;top:100%;left:0;right:0;background:white;border-radius:var(--border-radius);box-shadow:var(--box-shadow);z-index:100;max-height:300px;overflow-y:auto;display:none;}
.suggestion-item{padding:12px 15px;cursor:pointer;border-bottom:1px solid var(--light-gray);display:flex;align-items:center;gap:10px;}
.suggestion-item:hover{background-color:var(--light);}
.suggestion-item i{color: var(--primary);}
.search-tags{display:flex;flex-wrap:wrap;gap:8px;margin-top:10px;}
.search-tag{background:var(--primary);color:white;padding:4px 10px;border-radius:20px;font-size:14px;display:flex;align-items:center;gap:5px;}
.search-tag i{cursor:pointer;}
</style>
</head>
<body>
<div class="container">
  <header>
    <h1>Sistema de Gestión de Inventario</h1>
  </header>

  <div class="search-section card">
    <div class="form-group">
      <label for="categoria">Categoría</label>
      <input type="text" id="categoria" placeholder="Ej: Electrodomésticos">
    </div>
    <div class="form-group">
      <label for="marca">Marca</label>
      <input type="text" id="marca" placeholder="Ej: Samsung">
    </div>
    <div class="form-group">
      <label for="desc">Descripción</label>
      <input type="text" id="desc" placeholder="Ej: Monitor 32''">
    </div>
    <div class="form-group">
      <label for="modelo">Modelo</label>
      <input type="text" id="modelo" placeholder="Ej: ABC123">
    </div>
    <div class="form-group">
      <label for="sku">SKU</label>
      <input type="text" id="sku" placeholder="Ej: 123456">
    </div>
    <button onclick="buscar()">Buscar <i class="fas fa-search"></i></button>
  </div>

  <div class="results-container">
    <div class="product-list card" id="product-list">
      <div class="empty-state" id="empty-state">
        <i class="fas fa-box-open"></i>
        <p>No hay productos para mostrar.</p>
      </div>
    </div>
    <div class="product-detail card" id="product-detail">
      <h3>Detalle del producto</h3>
      <p>Selecciona un producto para ver sus detalles.</p>
    </div>
  </div>

  <div class="log-section card">
    <h3>Registro de actividad</h3>
    <div class="table-container">
      <table id="log-table">
        <thead>
          <tr>
            <th>Fecha</th>
            <th>Usuario</th>
            <th>Acción</th>
            <th>Detalle</th>
          </tr>
        </thead>
        <tbody>
          <tr><td colspan="4">No hay registros.</td></tr>
        </tbody>
      </table>
    </div>
  </div>
</div>

<div class="notification" id="notification"></div>

<script>
const webAppUrl = "https://script.google.com/u/0/home/projects/1PTrUsVhldkrNmqIIKfUr_PI5smXqRZ4NXrzijo4j6sNfm2z6Dh6Muw0t"; // <-- reemplazar con la URL de tu Web App

let productoSeleccionado = null;

function mostrarNotificacion(msg) {
  const notif = document.getElementById('notification');
  notif.innerText = msg;
  notif.style.display = 'block';
  setTimeout(()=>{ notif.style.display='none'; },3000);
}

function mostrarCoincidencias(productos){
  const list = document.getElementById('product-list');
  const empty = document.getElementById('empty-state');
  list.innerHTML = "";
  if(!productos || productos.length===0){
    empty.style.display="block";
    return;
  }
  empty.style.display="none";
  productos.forEach((p,i)=>{
    const div = document.createElement('div');
    div.className="product-card";
    div.innerHTML=`<strong>${p.desc}</strong> <span class="badge badge-primary">${p.sku}</span>`;
    div.onclick=()=>seleccionarProducto(p,div);
    list.appendChild(div);
  });
}

function seleccionarProducto(p,div){
  productoSeleccionado = p;
  document.querySelectorAll('.product-card').forEach(c=>c.classList.remove('selected'));
  div.classList.add('selected');
  const detail = document.getElementById('product-detail');
  detail.innerHTML=`
    <h3>${p.desc}</h3>
    <p><strong>SKU:</strong> ${p.sku}</p>
    <p><strong>Categoría:</strong> ${p.categoria}</p>
    <p><strong>Marca:</strong> ${p.marca}</p>
    <p><strong>Modelo:</strong> ${p.modelo}</p>
    <div class="form-group">
      <label for="cant">Cantidad</label>
      <input type="number" id="cant" value="1">
    </div>
    <div class="form-group">
      <label for="estado">Estado</label>
      <select id="estado">
        <option value="Disponible">Disponible</option>
        <option value="Dañado">Dañado</option>
        <option value="Defecto">Defecto</option>
      </select>
    </div>
    <button onclick="guardar(${p.row})">Guardar <i class="fas fa-save"></i></button>
  `;
}

async function buscar(){
  const params = new URLSearchParams({
    action:'buscar',
    categoria: document.getElementById('categoria').value,
    marca: document.getElementById('marca').value,
    desc: document.getElementById('desc').value,
    modelo: document.getElementById('modelo').value,
    sku: document.getElementById('sku').value
  });
  const res = await fetch(webAppUrl + "?" + params.toString());
  const data = await res.json();
  mostrarCoincidencias(data.data);
  actualizarLog();
}

async function guardar(row){
  if(!productoSeleccionado){ mostrarNotificacion("Selecciona un producto primero"); return; }
  const cantidad = document.getElementById('cant').value;
  const estado = document.getElementById('estado').value;
  const res = await fetch(webAppUrl,{
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body: JSON.stringify({action:'update', fila:row, cantidad, estado, producto: productoSeleccionado})
  });
  const data = await res.json();
  mostrarNotificacion(data.message);
  buscar();
}

async function actualizarLog(){
  const res = await fetch(webAppUrl + "?action=log");
  const data = await res.json();
  const tbody = document.querySelector("#log-table tbody");
  tbody.innerHTML = "";
  if(!data.data || data.data.length===0){
    tbody.innerHTML="<tr><td colspan='4'>No hay registros.</td></tr>";
    return;
  }
  data.data.forEach(r=>{
    const tr = document.createElement('tr');
    tr.innerHTML=`<td>${r.fecha}</td><td>${r.usuario}</td><td>${r.accion}</td><td>${r.detalle}</td>`;
    tbody.appendChild(tr);
  });
}
</script>
</body>
</html>
